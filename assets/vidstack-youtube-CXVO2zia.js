var te=Object.defineProperty;var se=(r,o,e)=>o in r?te(r,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[o]=e;var S=(r,o,e)=>(se(r,typeof o!="symbol"?o+"":o,e),e),L=(r,o,e)=>{if(!o.has(r))throw TypeError("Cannot "+e)};var s=(r,o,e)=>(L(r,o,"read from private field"),e?e.call(r):o.get(r)),n=(r,o,e)=>{if(o.has(r))throw TypeError("Cannot add the same private member more than once");o instanceof WeakSet?o.add(r):o.set(r,e)},l=(r,o,e,t)=>(L(r,o,"write to private field"),t?t.call(r,e):o.set(r,e),e);var a=(r,o,e)=>(L(r,o,"access private method"),e);import{aE as ie,s as ae,z as oe,e as re,k as ne,E as de,aB as he,P as V,ai as ue}from"./vidstack-DWQEfrPg-HzF3ULQC.js";import{T as U}from"./vidstack-player-BnQFvO7y.js";import{E as le}from"./vidstack-BePVaxm4-CGKK2BTl.js";import{resolveYouTubeVideoId as ce}from"./vidstack-Zc3I7oOd-CA6XwpqT.js";import"./app-JuY7pBv_.js";import"./vidstack-DXXgp8ue-em0aUobw.js";const b={Ended:0,Playing:1,Paused:2,Buffering:3,Cued:5};var i,k,v,E,P,f,y,q,pe,A,ye,_,H,p,m,D,J,O,K,j,Q,C,z,$,B,Y,W,F,X,M,N,w,R,x,Z;class we extends le{constructor(e,t){super(e);n(this,q);n(this,A);n(this,_);n(this,p);n(this,D);n(this,O);n(this,j);n(this,C);n(this,$);n(this,Y);n(this,F);n(this,M);n(this,w);n(this,x);S(this,"$$PROVIDER_TYPE","YOUTUBE");S(this,"scope",ie());n(this,i,void 0);n(this,k,ae(""));n(this,v,-1);n(this,E,null);n(this,P,-1);n(this,f,!1);n(this,y,new Map);S(this,"language","en");S(this,"color","red");S(this,"cookies",!1);l(this,i,t)}get currentSrc(){return s(this,E)}get type(){return"youtube"}get videoId(){return s(this,k).call(this)}preconnect(){oe(this.getOrigin())}setup(){super.setup(),re(a(this,_,H).bind(this)),s(this,i).notify("provider-setup",this)}destroy(){a(this,M,N).call(this);const e="provider destroyed";for(const t of s(this,y).values())for(const{reject:d}of t)d(e);s(this,y).clear()}async play(){return a(this,p,m).call(this,"playVideo")}async pause(){return a(this,p,m).call(this,"pauseVideo")}setMuted(e){e?a(this,p,m).call(this,"mute"):a(this,p,m).call(this,"unMute")}setCurrentTime(e){a(this,p,m).call(this,"seekTo",e),s(this,i).notify("seeking",e)}setVolume(e){a(this,p,m).call(this,"setVolume",e*100)}setPlaybackRate(e){a(this,p,m).call(this,"setPlaybackRate",e)}async loadSource(e){if(!ne(e.src)){l(this,E,null),s(this,k).set("");return}const t=ce(e.src);s(this,k).set(t??""),l(this,E,e)}getOrigin(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}buildParams(){const{keyDisabled:e}=s(this,i).$props,{muted:t,playsInline:d,nativeControls:u}=s(this,i).$state,h=u();return{autoplay:0,cc_lang_pref:this.language,cc_load_policy:h?1:void 0,color:this.color,controls:h?1:0,disablekb:!h||e()?1:0,enablejsapi:1,fs:1,hl:this.language,iv_load_policy:h?1:3,mute:t()?1:0,playsinline:d()?1:0}}onLoad(){window.setTimeout(()=>this.postMessage({event:"listening"}),100)}onMessage({info:e},t){var c;if(!e)return;const{title:d,intrinsicDuration:u,playbackRate:h}=s(this,i).$state;if(he(e.videoData)&&e.videoData.title!==d()&&s(this,i).notify("title-change",e.videoData.title,t),V(e.duration)&&e.duration!==u()){if(V(e.videoLoadedFraction)){const g=((c=e.progressState)==null?void 0:c.loaded)??e.videoLoadedFraction*e.duration,T=new U(0,e.duration);a(this,C,z).call(this,g,T,t)}s(this,i).notify("duration-change",e.duration,t)}if(V(e.playbackRate)&&e.playbackRate!==h()&&s(this,i).notify("rate-change",e.playbackRate,t),e.progressState){const{current:g,seekableStart:T,seekableEnd:I,loaded:ee,duration:G}=e.progressState;a(this,j,Q).call(this,g,t),a(this,C,z).call(this,ee,new U(T,I),t),G!==u()&&s(this,i).notify("duration-change",G,t)}if(V(e.volume)&&ue(e.muted)&&!s(this,f)){const g={muted:e.muted,volume:e.volume/100};s(this,i).notify("volume-change",g,t)}V(e.playerState)&&e.playerState!==s(this,v)&&a(this,F,X).call(this,e.playerState,t)}}i=new WeakMap,k=new WeakMap,v=new WeakMap,E=new WeakMap,P=new WeakMap,f=new WeakMap,y=new WeakMap,q=new WeakSet,pe=function(e){var t;(t=a(this,w,R).call(this,"playVideo"))==null||t.reject(e)},A=new WeakSet,ye=function(e){var t;(t=a(this,w,R).call(this,"pauseVideo"))==null||t.reject(e)},_=new WeakSet,H=function(){a(this,M,N).call(this);const e=s(this,k).call(this);if(!e){this.src.set("");return}this.src.set(`${this.getOrigin()}/embed/${e}`),s(this,i).notify("load-start")},p=new WeakSet,m=function(e,t){let d=de(),u=s(this,y).get(e);return u||s(this,y).set(e,u=[]),u.push(d),this.postMessage({event:"command",func:e,args:t?[t]:void 0}),d.promise},D=new WeakSet,J=function(e){s(this,i).notify("loaded-metadata"),s(this,i).notify("loaded-data"),s(this,i).delegate.ready(void 0,e)},O=new WeakSet,K=function(e){var t;(t=a(this,w,R).call(this,"pauseVideo"))==null||t.resolve(),s(this,i).notify("pause",void 0,e)},j=new WeakSet,Q=function(e,t){const{duration:d,realCurrentTime:u}=s(this,i).$state,h=s(this,v)===b.Ended,c=h?d():e;s(this,i).notify("time-change",c,t),!h&&Math.abs(c-u())>1&&s(this,i).notify("seeking",c,t)},C=new WeakSet,z=function(e,t,d){const u={buffered:new U(0,e),seekable:t};s(this,i).notify("progress",u,d);const{seeking:h,realCurrentTime:c}=s(this,i).$state;h()&&e>c()&&a(this,$,B).call(this,d)},$=new WeakSet,B=function(e){const{paused:t,realCurrentTime:d}=s(this,i).$state;window.clearTimeout(s(this,P)),l(this,P,window.setTimeout(()=>{s(this,i).notify("seeked",d(),e),l(this,P,-1)},t()?100:0))},Y=new WeakSet,W=function(e){const{seeking:t}=s(this,i).$state;t()&&a(this,$,B).call(this,e),s(this,i).notify("pause",void 0,e),s(this,i).notify("end",void 0,e)},F=new WeakSet,X=function(e,t){var I;const{paused:d,seeking:u}=s(this,i).$state,h=e===b.Playing,c=e===b.Buffering,g=a(this,x,Z).call(this,"playVideo"),T=d()&&(c||h);if(c&&s(this,i).notify("waiting",void 0,t),u()&&h&&a(this,$,B).call(this,t),s(this,f)&&h){this.pause(),l(this,f,!1),this.setMuted(s(this,i).$state.muted());return}if(!g&&T){l(this,f,!0),this.setMuted(!0);return}switch(T&&((I=a(this,w,R).call(this,"playVideo"))==null||I.resolve(),s(this,i).notify("play",void 0,t)),e){case b.Cued:a(this,D,J).call(this,t);break;case b.Playing:s(this,i).notify("playing",void 0,t);break;case b.Paused:a(this,O,K).call(this,t);break;case b.Ended:a(this,Y,W).call(this,t);break}l(this,v,e)},M=new WeakSet,N=function(){l(this,v,-1),l(this,P,-1),l(this,f,!1)},w=new WeakSet,R=function(e){var t;return(t=s(this,y).get(e))==null?void 0:t.shift()},x=new WeakSet,Z=function(e){var t;return!!((t=s(this,y).get(e))!=null&&t.length)};export{we as YouTubeProvider};
