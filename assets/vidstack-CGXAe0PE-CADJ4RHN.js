var Di=Object.defineProperty;var Oi=(n,t,e)=>t in n?Di(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var R=(n,t,e)=>(Oi(n,typeof t!="symbol"?t+"":t,e),e),Ot=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var i=(n,t,e)=>(Ot(n,t,"read from private field"),e?e.call(n):t.get(n)),a=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},c=(n,t,e,r)=>(Ot(n,t,"write to private field"),r?r.call(n,e):t.set(n,e),e);var s=(n,t,e)=>(Ot(n,t,"access private method"),e);import{aE as Ii,o as Jt,g as K,aQ as Hi,k as Fi,G as Wt,e as Xt,aR as J,N as Ui,v as Vi,p as ji,aa as qi,l as _t,D as Bi,s as Ht}from"./vidstack-DWQEfrPg-HzF3ULQC.js";import{R as Wi}from"./vidstack-DSYpsFWk-D92Byy8J.js";import{g as Qt}from"./vidstack-DXXgp8ue-em0aUobw.js";import{L as It}from"./vidstack-player-BnQFvO7y.js";let Q=null,X=[],Y=[];function Kt(){return Q??(Q=new AudioContext)}function _i(){const n=Kt(),t=n.createGain();return t.connect(n.destination),X.push(t),t}function Ki(n,t){const e=Kt(),r=e.createMediaElementSource(n);return t&&r.connect(t),Y.push(r),r}function Qi(n){const t=X.indexOf(n);t!==-1&&(X.splice(t,1),n.disconnect(),Yt())}function zi(n){const t=Y.indexOf(n);t!==-1&&(Y.splice(t,1),n.disconnect(),Yt())}function Yt(){Q&&X.length===0&&Y.length===0&&Q.close().then(()=>{Q=null})}var D,E,m,p,Z,Zt,O,Ft;class Ji{constructor(t,e){a(this,Z);a(this,O);a(this,D,void 0);a(this,E,void 0);a(this,m,null);a(this,p,null);c(this,D,t),c(this,E,e)}get currentGain(){var t,e;return((e=(t=i(this,m))==null?void 0:t.gain)==null?void 0:e.value)??null}get supported(){return!0}setGain(t){const e=this.currentGain;if(t!==this.currentGain){if(t===1&&e!==1){this.removeGain();return}i(this,m)||(c(this,m,_i()),i(this,p)&&i(this,p).connect(i(this,m))),i(this,p)||c(this,p,Ki(i(this,D),i(this,m))),i(this,m).gain.value=t,i(this,E).call(this,t)}}removeGain(){i(this,m)&&(i(this,p)&&i(this,p).connect(Kt().destination),s(this,O,Ft).call(this),i(this,E).call(this,null))}destroy(){s(this,Z,Zt).call(this),s(this,O,Ft).call(this)}}D=new WeakMap,E=new WeakMap,m=new WeakMap,p=new WeakMap,Z=new WeakSet,Zt=function(){if(i(this,p))try{zi(i(this,p))}catch{}finally{c(this,p,null)}},O=new WeakSet,Ft=function(){if(i(this,m))try{Qi(i(this,m))}catch{}finally{c(this,m,null)}};const Xi=["focus","blur","visibilitychange","pageshow","pagehide"];var S,A,I,tt,ti;class Yi{constructor(){a(this,tt);a(this,S,Ht(zt()));a(this,A,Ht(document.visibilityState));a(this,I,void 0)}connect(){const t=new Wt(window),e=s(this,tt,ti).bind(this);for(const r of Xi)t.add(r,e);J&&t.add("beforeunload",r=>{c(this,I,setTimeout(()=>{r.defaultPrevented||r.returnValue.length>0||(i(this,S).set("hidden"),i(this,A).set("hidden"))},0))})}get pageState(){return i(this,S).call(this)}get visibility(){return i(this,A).call(this)}}S=new WeakMap,A=new WeakMap,I=new WeakMap,tt=new WeakSet,ti=function(t){J&&window.clearTimeout(i(this,I)),(t.type!=="blur"||i(this,S).call(this)==="active")&&(i(this,S).set(zt(t)),i(this,A).set(document.visibilityState=="hidden"?"hidden":"visible"))};function zt(n){return(n==null?void 0:n.type)==="blur"||document.visibilityState==="hidden"?"hidden":document.hasFocus()?"active":"passive"}var H,h,b,L,x,w,F,G,o,d,it,ii,N,$,et,ei,st,si,at,ai,nt,ni,rt,qt,u,l,Bt,te,v,k,ht,ri,U,Ut,ot,hi,dt,oi,ct,di,M,z,ut,ci,lt,ui,ft,li,mt,fi,pt,mi,yt,pi,gt,yi,vt,gi,bt,vi,Tt,bi,kt,Ti,St,ki,wt,Si,Pt,wi,Ct,Pi,Et,Ci,At,Ei,Lt,Ai;class Zi{constructor(t,e){a(this,o);a(this,it);a(this,et);a(this,st);a(this,at);a(this,nt);a(this,u);a(this,Bt);a(this,v);a(this,ht);a(this,U);a(this,ot);a(this,dt);a(this,ct);a(this,M);a(this,ut);a(this,lt);a(this,ft);a(this,mt);a(this,pt);a(this,yt);a(this,gt);a(this,vt);a(this,bt);a(this,Tt);a(this,kt);a(this,St);a(this,wt);a(this,Pt);a(this,Ct);a(this,Et);a(this,At);a(this,Lt);a(this,H,void 0);a(this,h,void 0);a(this,b,!1);a(this,L,!1);a(this,x,!1);a(this,w,new Wi(s(this,et,ei).bind(this)));a(this,F,new Yi);a(this,G,void 0);a(this,N,0);a(this,$,-1);a(this,rt,void 0);a(this,qt,void 0);c(this,H,t),c(this,h,e),c(this,G,new Wt(t.media)),s(this,st,si).call(this),i(this,F).connect(),Xt(s(this,bt,vi).bind(this)),Jt(s(this,it,ii).bind(this))}}H=new WeakMap,h=new WeakMap,b=new WeakMap,L=new WeakMap,x=new WeakMap,w=new WeakMap,F=new WeakMap,G=new WeakMap,o=new WeakSet,d=function(){return i(this,H).media},it=new WeakSet,ii=function(){var t;c(this,L,!1),c(this,x,!1),i(this,w).stop(),i(this,G).abort(),(t=i(this,rt))==null||t.clear()},N=new WeakMap,$=new WeakMap,et=new WeakSet,ei=function(){const t=i(this,o,d).currentTime;!(J&&t-i(this,$)<.35)&&i(this,N)!==t&&(s(this,v,k).call(this,t),c(this,N,t))},st=new WeakSet,si=function(){s(this,u,l).call(this,"loadstart",s(this,ht,ri)),s(this,u,l).call(this,"abort",s(this,U,Ut)),s(this,u,l).call(this,"emptied",s(this,ot,hi)),s(this,u,l).call(this,"error",s(this,Lt,Ai)),s(this,u,l).call(this,"volumechange",s(this,St,ki))},at=new WeakSet,ai=function(){i(this,L)||(s(this,u,l).call(this,"loadeddata",s(this,dt,oi)),s(this,u,l).call(this,"loadedmetadata",s(this,ct,di)),s(this,u,l).call(this,"canplay",s(this,ft,li)),s(this,u,l).call(this,"canplaythrough",s(this,mt,fi)),s(this,u,l).call(this,"durationchange",s(this,kt,Ti)),s(this,u,l).call(this,"play",s(this,ut,ci)),s(this,u,l).call(this,"progress",s(this,Ct,Pi)),s(this,u,l).call(this,"stalled",s(this,yt,pi)),s(this,u,l).call(this,"suspend",s(this,Et,Ci)),s(this,u,l).call(this,"ratechange",s(this,At,Ei)),c(this,L,!0))},nt=new WeakSet,ni=function(){i(this,x)||(s(this,u,l).call(this,"pause",s(this,lt,ui)),s(this,u,l).call(this,"playing",s(this,pt,mi)),s(this,u,l).call(this,"seeked",s(this,wt,Si)),s(this,u,l).call(this,"seeking",s(this,Pt,wi)),s(this,u,l).call(this,"ended",s(this,vt,gi)),s(this,u,l).call(this,"waiting",s(this,gt,yi)),c(this,x,!0))},rt=new WeakMap,qt=new WeakMap,u=new WeakSet,l=function(t,e){i(this,G).add(t,e.bind(this))},Bt=new WeakSet,te=function(t){},v=new WeakSet,k=function(t,e){const r=Math.min(t,i(this,h).$state.seekableEnd());i(this,h).notify("time-change",r,e)},ht=new WeakSet,ri=function(t){if(i(this,o,d).networkState===3){s(this,U,Ut).call(this,t);return}s(this,at,ai).call(this),i(this,h).notify("load-start",void 0,t)},U=new WeakSet,Ut=function(t){i(this,h).notify("abort",void 0,t)},ot=new WeakSet,hi=function(){i(this,h).notify("emptied",void 0,event)},dt=new WeakSet,oi=function(t){i(this,h).notify("loaded-data",void 0,t)},ct=new WeakSet,di=function(t){c(this,N,0),c(this,$,-1),s(this,nt,ni).call(this),i(this,h).notify("loaded-metadata",void 0,t),(Ui||J&&Vi(i(this,h).$state.source()))&&i(this,h).delegate.ready(s(this,M,z).call(this),t)},M=new WeakSet,z=function(){return{provider:ji(i(this,h).$provider),duration:i(this,o,d).duration,buffered:i(this,o,d).buffered,seekable:i(this,o,d).seekable}},ut=new WeakSet,ci=function(t){i(this,h).$state.canPlay&&i(this,h).notify("play",void 0,t)},lt=new WeakSet,ui=function(t){i(this,o,d).readyState===1&&!i(this,b)||(c(this,b,!1),i(this,w).stop(),i(this,h).notify("pause",void 0,t))},ft=new WeakSet,li=function(t){i(this,h).delegate.ready(s(this,M,z).call(this),t)},mt=new WeakSet,fi=function(t){i(this,h).$state.started()||i(this,h).notify("can-play-through",s(this,M,z).call(this),t)},pt=new WeakSet,mi=function(t){i(this,o,d).paused||(c(this,b,!1),i(this,h).notify("playing",void 0,t),i(this,w).start())},yt=new WeakSet,pi=function(t){i(this,h).notify("stalled",void 0,t),i(this,o,d).readyState<3&&(c(this,b,!0),i(this,h).notify("waiting",void 0,t))},gt=new WeakSet,yi=function(t){i(this,o,d).readyState<3&&(c(this,b,!0),i(this,h).notify("waiting",void 0,t))},vt=new WeakSet,gi=function(t){i(this,w).stop(),s(this,v,k).call(this,i(this,o,d).duration,t),i(this,h).notify("end",void 0,t),i(this,h).$state.loop()&&qi(i(this,o,d).controls)&&(i(this,o,d).controls=!1)},bt=new WeakSet,vi=function(){const t=i(this,h).$state.paused(),e=i(this,F).visibility==="hidden";(t||e)&&_t(i(this,o,d),"timeupdate",s(this,Tt,bi).bind(this))},Tt=new WeakSet,bi=function(t){s(this,v,k).call(this,i(this,o,d).currentTime,t)},kt=new WeakSet,Ti=function(t){i(this,h).$state.ended()&&s(this,v,k).call(this,i(this,o,d).duration,t),i(this,h).notify("duration-change",i(this,o,d).duration,t)},St=new WeakSet,ki=function(t){const e={volume:i(this,o,d).volume,muted:i(this,o,d).muted};i(this,h).notify("volume-change",e,t)},wt=new WeakSet,Si=function(t){c(this,$,i(this,o,d).currentTime),s(this,v,k).call(this,i(this,o,d).currentTime,t),i(this,h).notify("seeked",i(this,o,d).currentTime,t),Math.trunc(i(this,o,d).currentTime)===Math.trunc(i(this,o,d).duration)&&Qt(i(this,o,d).duration)>Qt(i(this,o,d).currentTime)&&(s(this,v,k).call(this,i(this,o,d).duration,t),i(this,o,d).ended||i(this,h).player.dispatch(new Bi("media-play-request",{trigger:t})))},Pt=new WeakSet,wi=function(t){i(this,h).notify("seeking",i(this,o,d).currentTime,t)},Ct=new WeakSet,Pi=function(t){const e={buffered:i(this,o,d).buffered,seekable:i(this,o,d).seekable};i(this,h).notify("progress",e,t)},Et=new WeakSet,Ci=function(t){i(this,h).notify("suspend",void 0,t)},At=new WeakSet,Ei=function(t){i(this,h).notify("rate-change",i(this,o,d).playbackRate,t)},Lt=new WeakSet,Ai=function(t){const e=i(this,o,d).error;if(!e)return;const r={message:e.message,code:e.code,mediaError:e};i(this,h).notify("error",r,t)};var V,g,T,C,xt,Li,Gt,xi,Nt,Gi,j,Vt,$t,Ni;class ie{constructor(t,e){a(this,T);a(this,xt);a(this,Gt);a(this,Nt);a(this,j);a(this,$t);a(this,V,void 0);a(this,g,void 0);c(this,V,t),c(this,g,e),i(this,T,C).onaddtrack=s(this,xt,Li).bind(this),i(this,T,C).onremovetrack=s(this,Gt,xi).bind(this),i(this,T,C).onchange=s(this,Nt,Gi).bind(this),_t(i(this,g).audioTracks,"change",s(this,$t,Ni).bind(this))}}V=new WeakMap,g=new WeakMap,T=new WeakSet,C=function(){return i(this,V).media.audioTracks},xt=new WeakSet,Li=function(t){const e=t.track;if(e.label==="")return;const r=e.id.toString()||`native-audio-${i(this,g).audioTracks.length}`,f={id:r,label:e.label,language:e.language,kind:e.kind,selected:!1};i(this,g).audioTracks[It.add](f,t),e.enabled&&(f.selected=!0)},Gt=new WeakSet,xi=function(t){const e=i(this,g).audioTracks.getById(t.track.id);e&&i(this,g).audioTracks[It.remove](e,t)},Nt=new WeakSet,Gi=function(t){let e=s(this,j,Vt).call(this);if(!e)return;const r=i(this,g).audioTracks.getById(e.id);r&&i(this,g).audioTracks[It.select](r,!0,t)},j=new WeakSet,Vt=function(){return Array.from(i(this,T,C)).find(t=>t.enabled)},$t=new WeakSet,Ni=function(t){const{current:e}=t.detail;if(!e)return;const r=i(this,T,C).getTrackById(e.id);if(r){const f=s(this,j,Vt).call(this);f&&(f.enabled=!1),r.enabled=!0}};var q,jt;class oe{constructor(t,e){a(this,q);R(this,"scope",Ii());R(this,"currentSrc",null);R(this,"audioGain");this.media=t,this.ctx=e,this.audioGain=new Ji(t,r=>{this.ctx.notify("audio-gain-change",r)})}setup(){new Zi(this,this.ctx),"audioTracks"in this.media&&new ie(this,this.ctx),Jt(()=>{this.audioGain.destroy(),this.media.srcObject=null,this.media.removeAttribute("src");for(const t of this.media.querySelectorAll("source"))t.remove();this.media.load()})}get type(){return""}setPlaybackRate(t){this.media.playbackRate=t}async play(){return this.media.play()}async pause(){return this.media.pause()}setMuted(t){this.media.muted=t}setVolume(t){this.media.volume=t}setCurrentTime(t){this.media.currentTime=t}setPlaysInline(t){K(this.media,"playsinline",t)}async loadSource({src:t,type:e},r){this.media.preload=r||"",Hi(t)?(this.removeSource(),this.media.srcObject=t):(this.media.srcObject=null,Fi(t)?e!=="?"?this.appendSource({src:t,type:e}):(this.removeSource(),this.media.src=s(this,q,jt).call(this,t)):(this.removeSource(),this.media.src=window.URL.createObjectURL(t))),this.media.load(),this.currentSrc={src:t,type:e}}appendSource(t,e){const r=this.media.querySelector("source[data-vds]"),f=r??document.createElement("source");K(f,"src",s(this,q,jt).call(this,t.src)),K(f,"type",t.type!=="?"?t.type:e),K(f,"data-vds",""),r||this.media.append(f)}removeSource(){var t;(t=this.media.querySelector("source[data-vds]"))==null||t.remove()}}q=new WeakSet,jt=function(t){const{clipStartTime:e,clipEndTime:r}=this.ctx.$state,f=e(),_=r();return f>0&&_>0?`${t}#t=${f},${_}`:f>0?`${t}#t=${f}`:_>0?`${t}#t=0,${_}`:t};var y,B,W,P,Mt,$i,Rt,Mi,Dt,Ri;class ee{constructor(t,e){a(this,Mt);a(this,Rt);a(this,Dt);a(this,y,void 0);a(this,B,void 0);a(this,W,void 0);a(this,P,Ht(!1));c(this,y,t),c(this,B,e),s(this,Mt,$i).call(this)}get supported(){return i(this,P).call(this)}async prompt(){if(!this.supported)throw Error("Not supported on this platform.");return this.type==="airplay"&&i(this,y).webkitShowPlaybackTargetPicker?i(this,y).webkitShowPlaybackTargetPicker():i(this,y).remote.prompt()}}y=new WeakMap,B=new WeakMap,W=new WeakMap,P=new WeakMap,Mt=new WeakSet,$i=function(){var t;!((t=i(this,y))!=null&&t.remote)||!this.canPrompt||(i(this,y).remote.watchAvailability(e=>{i(this,P).set(e)}).catch(()=>{i(this,P).set(!1)}),Xt(s(this,Rt,Mi).bind(this)))},Rt=new WeakSet,Mi=function(){if(!i(this,P).call(this))return;const t=["connecting","connect","disconnect"],e=s(this,Dt,Ri).bind(this);e(),_t(i(this,y),"playing",e);const r=new Wt(i(this,y).remote);for(const f of t)r.add(f,e)},Dt=new WeakSet,Ri=function(t){const e=i(this,y).remote.state;if(e===i(this,W))return;const r={type:this.type,state:e};i(this,B).notify("remote-playback-change",r,t),c(this,W,e)};class de extends ee{constructor(){super(...arguments);R(this,"type","airplay")}get canPrompt(){return"WebKitPlaybackTargetAvailabilityEvent"in window}}export{oe as H,de as a};
